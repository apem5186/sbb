<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" crossorigin="anonymous"></script>
  <!-- sbb CSS -->
<!--  <link rel="stylesheet" type="text/css" th:href="@{/style.css}">-->
  <!-- Bootstrap icon -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css" />
  <title>Hello, sbb!</title>

</head>
<body>
  <!-- 네비게이션 바 -->
  <nav th:replace="~{navbar :: navbarFragment}"></nav>
  <!-- 기본 템플릿 안에 삽입될 내용 Start -->
  <th:block layout:fragment="content"></th:block>
  <!-- 기본 템플릿 안에 삽입될 내용 End -->
  <!-- 자바스크립트 Start -->
  <th:block layout:fragment="script"></th:block>
  <script type="text/javascript">
    $("#userBtn").on('click', function () {
      $.ajax({
        type : "GET",
        url : "http://localhost:8080/getProfile",
        dataType : "json",
        success : function (data) {
          $(".modal-body #email").val(data.email);
          $(".modal-body #username").val(data.username);
        },
        error : function (status, error, data) {
          console.log("ERROR!");
          console.log(data);
          console.log(status, error);
        }
      });
    });

    function userModify() {
      $(".modal-header #userDelete").hide();
      $(".modal-body #username").attr("disabled", false);
      $(".modal-body #email").attr("disabled", false);
      $(".modal-body #password_1").show();
      $(".modal-body #password_2").show();
      $(".modal-body #formSubmit").show();
      $(".modal-footer #formCancel").show();
      $("#userModify").hide();
    }

    function userModifyCancel() {
      $(".modal-header #userDelete").show();
      $(".modal-body #username").attr("disabled", true);
      $(".modal-body #email").attr("disabled", true);
      $(".modal-body #password_1").hide();
      $(".modal-body #password_2").hide();
      $(".modal-footer #formSubmit").hide();
      $(".modal-footer #formCancel").hide();
      $("#userModify").show();
    }

    function userModifySubmit(e) {
      const data = new FormData();
      const triggerBtn = e.relatedTarget;
      const username = triggerBtn.getAttribute("data-bs-username");
      const password = triggerBtn.getAttribute("data-bs-password1");
      const email = triggerBtn.getAttribute("data-bs-email");
      data.set(username, username);
      data.set(password, password);
      data.set(email, email);

      console.log(data);
      $.ajax({
        type: "POST",
        url: "http://localhost:8080/user/modify",
        data : data,
        processData : false,
        contentType : "application/json",
        success : function (data) {
          console.log(data);
        },
        error : function (status, error, data) {
          console.log("ERROR!");
          console.log(status);
          console.log(error);
          console.log(data);
        }
      });
    }
    // $(".modal-dialog #userModify").on('click', function () {
    //   console.log("hello");
    //
    // });
  </script>
  <!-- 자바스크립트 End -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
  <div th:replace="~{user_modal :: modalFragment}"></div>
</body>
</html>
